<h1>Dynamic Malware Analysis </h1>

<h2>Introuduction</h2>

Introduction
In this Let'sDefend Dynamic Malware Analysis walkthrough, we're going to dive into how to use tools like Wireshark and Process Monitor (Procmon) for dynamic malware analysis. It’s not as scary as it sounds—promise!

What is Dynamic Malware Analysis?

So, what exactly is dynamic malware analysis? Essentially, it's a way to understand what malware does by watching it in action. Instead of just looking at the code, we run the malware in a safe, controlled environment—like a virtual machine or a sandbox—so we can see how it behaves without putting our main system at risk.

During this analysis, we keep an eye on a bunch of things happening at the system level: changes to files, tweaks in the registry, network traffic, new processes starting up, and the like. By watching these events in real-time, we can get a clear picture of what the malware is up to.

What is Wireshark?

Let’s talk about Wireshark. This tool is a favorite among network admins, security pros, and developers for a reason. It lets you capture and analyze network traffic as it happens. With Wireshark, you can dig into the data packets moving across your network, seeing details like IP addresses, ports, and even the content of those packets. Whether you're troubleshooting network issues or digging into suspicious activity, Wireshark gives you the inside scoop.

What is Procmon?

Now, onto Procmon—short for Process Monitor. This tool is like a magnifying glass for your Windows system, giving you a real-time look at what's going on under the hood. Developed by Microsoft, Procmon tracks processes, threads, file system activity, registry changes, and network actions, all in real time. It’s a go-to for diagnosing system hiccups, like application crashes or sluggish performance, and it's a lifesaver when dealing with malware infections.

With Procmon, you can watch how files are being read or written, see when processes start and stop, and track network connections. Plus, you can filter and search through the data to focus on specific activities, making it easier to pinpoint problems. When you’re doing dynamic malware analysis, Procmon is your best friend because it shows you exactly what the malware is trying to do.

<h2>Tools Used</h2>

- WireShark

- Notepad

- Procmon

- Process Hacker


 
 
 
 Here's an example of our problem

 Our first question

<img src="https://i.imgur.com/vmeWtXu.png" height="80%" width="80%" alt=/>

<img src="https://i.imgur.com/2U7Iuyn.png" height="80%" width="80%" alt=/>

So, first thing we do is open the Malware folder, lets open the law.exe file 

<img src="https://i.imgur.com/Mr7xIbS.png" height="80%" width="80%" alt=/>

Next, open Wireshark and click on Ethernet.

<img src="https://i.imgur.com/FdPUeKX.png" height="80%" width="80%" alt=/>

Now Procmon

<img src="https://i.imgur.com/lzrOeoI.png" height="80%" width="80%" alt=/>

Allow our tools to load, give a about 20 seconds.

<img src="https://i.imgur.com/LrfKqbC.png" height="80%" width="80%" alt=/>

Now lets double click on the file law.exe.zip

<img src="https://i.imgur.com/oopJ7PD.png" height="80%" width="80%" alt=/>

If you at the Procmon tool, you can see the file was perform.

<img src="https://i.imgur.com/dnbAHyf.png" height="80%" width="80%" alt=/>

If we look in wireshark in a moment we can start to see the data once we type SMTP.

Next click the Red button to stop capturing packets in Wireshark.

Next, in Procmon click the Capture button.

<img src="https://i.imgur.com/1LZY91c.png" height="80%" width="80%" alt=/>

Lets use WireShark to check the SMTP traffic to find the domain the malware connects to for data hijacking.

Enter smpt press Enter, select and right click the first packet, hover over to Follow then TCP Stream.

<img src="https://i.imgur.com/7gjYBR7.png" height="80%" width="80%" alt=/>

The Domain is right in the TCP Stream  us2.smtp.mailhostbox.com

<img src="https://i.imgur.com/vvyWCcQ.png" height="80%" width="80%" alt=/>

Question 2

<img src="https://i.imgur.com/TKHAaCR.png" height="80%" width="80%" alt=/>

Used Wireshark to a filter so we can find the port number

Type tcp.stream eq 12 press enter, then right click info tab, and now column preferences.


<img src="https://i.imgur.com/McitjUE.png" height="80%" width="80%" alt=/>

Click the + to add a new column.

<img src="https://i.imgur.com/PjGR7Po.png" height="80%" width="80%" alt=/>

Now name the new column dst.port and change the type to Dest port(unreesolved). Click OK.

<img src="https://i.imgur.com/L897UZg.png" height="80%" width="80%" alt=/>

Now we have a dst.port column showing the destinations ports

<img src="https://i.imgur.com/kd752gW.png" height="80%" width="80%" alt=/>

Type SMTP and we see the answer, Port 587.

<img src="https://i.imgur.com/1TPS1ZW.png" height="80%" width="80%" alt=/>

Question 3

<img src="https://i.imgur.com/ywPtn1h.png" height="80%" width="80%" alt=/>

In order to answer this we need to find the AppData directory path using Procmon.

<img src="https://i.imgur.com/AuFjtTc.png" height="80%" width="80%" alt=/>

While in Procmon uncheck all the blue boxes

<img src="https://i.imgur.com/K9LJUwa.png" height="80%" width="80%" alt=/>

Now check Show File System Activity.

<img src="https://i.imgur.com/vBwhFj7.png" height="80%" width="80%" alt=/>

Right click on the malware executable file-Rename

<img src="https://i.imgur.com/tfv4nvx.png" height="80%" width="80%" alt=/>

Highlight the name and copy it.

<img src="https://i.imgur.com/hlWShIk.png" height="80%" width="80%" alt=/>

Return to Procmon and click Filter.

<img src="https://i.imgur.com/IcvTWUk.png" height="80%" width="80%" alt=/>

Click the Architecture drop down bar, Select Process Name.

<img src="https://i.imgur.com/h0yAFMh.png" height="80%" width="80%" alt=/>

Paste in the Malware file name and click add.

<img src="https://i.imgur.com/xVf8SBb.png" height="80%" width="80%" alt=/>

The green check indicates we are filtering for that process which is the malware.

Click Apply and OK.

<img src="https://i.imgur.com/DpT77Se.png" height="80%" width="80%" alt=/>

We scroll down until we see CreateFile for AppData\Roaming\AheGmkp executable file.

<img src="https://i.imgur.com/nlBrnXH.png" height="80%" width="80%" alt=/>

Right click and select Properties.

<img src="https://i.imgur.com/3Emos0u.png" height="80%" width="80%" alt=/>

Now we can confirm the name of exectuable file is AheGmkp.exe

<img src="https://i.imgur.com/ltiKrh7.png" height="80%" width="80%" alt=/>

Question 4

<img src="https://i.imgur.com/pmg4NmY.png" height="80%" width="80%" alt=/>

In Procmon uncheck show File System Activity and check Show Registry Activity.

<img src="https://i.imgur.com/isGoOM6.png" height="80%" width="80%" alt=/>

The malware hides in the registry keys, so we scroll down in Procmon until we see HKCU with the AhemGmkp.exe.file

<img src="https://i.imgur.com/0yaivAE.png" height="80%" width="80%" alt=/>

Right click and Select Properties.

<img src="https://i.imgur.com/6cgTSMK.png" height="80%" width="80%" alt=/>

Here we can confirm the register key.

<img src="https://i.imgur.com/5lla7cA.png" height="80%" width="80%" alt=/>

<h2>Another great learning experience. WAY TO SOC IT TO THEM..............</h2






 







  




</p>

<!--
 ```diff
- text in red
+ text in green
! text in orange
# text in gray
@@ text in purple (and bold)@@
```
--!>
